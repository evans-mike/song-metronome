<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <!-- Ensure proper scaling on mobile devices -->
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Multi BPM + Time Signature Beat Numbers</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 10px;
      margin: 0;
    }

    h1 {
      font-size: 1.5em;
      text-align: center;
      margin-bottom: 20px;
    }

    /* Container for all rows */
    #songContainer {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    /* Each row styling */
    .song-row {
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      padding: 10px;
      border: 1px solid #ccc;
      border-radius: 8px;
    }

    .song-row label {
      margin-right: 5px;
      font-size: 0.9em;
      min-width: 70px;
    }

    .song-row input[type="text"],
    .song-row input[type="number"],
    .song-row select {
      padding: 5px;
      font-size: 0.9em;
      margin-right: 10px;
      margin-bottom: 5px;
    }

    /* Beat indicator container */
    .beat-indicator {
      display: inline-block;
      margin-bottom: 5px;
    }

    /* Each beat number styling */
    .beat-indicator span {
      display: inline-block;
      margin-right: 5px;
      font-weight: bold;
      color: #ccc;  /* lighter grey */
      font-size: 2em;  /* larger numbers */
      transition: color 0.2s;
    }

    /* When active, change the number's color to black */
    .beat-indicator span.beat-active,
    .beat-indicator span.downbeat-active {
      color: black;
    }

    /* Responsive adjustments for small screens */
    @media (max-width: 480px) {
      .song-row {
        flex-direction: column;
        align-items: flex-start;
      }
      .song-row label,
      .song-row input[type="text"],
      .song-row input[type="number"],
      .song-row select,
      .beat-indicator {
        margin-right: 0;
      }
      .song-row input,
      .song-row select {
        width: 100%;
      }
    }

    /* Style for the Copy URL button */
    #copyUrlBtn {
      display: block;
      margin: 20px auto;
      padding: 10px 20px;
      font-size: 1em;
    }
  </style>
</head>
<body>
  <h1>Multi BPM + Time Signature Beat Numbers</h1>
  
  <!-- Container for song rows -->
  <div id="songContainer">
    <!-- Row 1 -->
    <div class="song-row" data-row="1">
      <label for="song1">Song 1:</label>
      <input id="song1" type="text" placeholder="Song Name" />
      <label for="bpm1">BPM:</label>
      <input id="bpm1" type="number" min="1" />
      <label for="timeSig1">Time Sig:</label>
      <select id="timeSig1">
        <option value="2/2">2/2</option>
        <option value="3/4" selected>3/4</option>
        <option value="4/4">4/4</option>
        <option value="6/8">6/8</option>
        <option value="9/8">9/8</option>
        <option value="12/8">12/8</option>
      </select>
      <!-- Beat numbers will be displayed here -->
      <div id="beatIndicator1" class="beat-indicator"></div>
    </div>

    <!-- Row 2 -->
    <div class="song-row" data-row="2">
      <label for="song2">Song 2:</label>
      <input id="song2" type="text" placeholder="Song Name" />
      <label for="bpm2">BPM:</label>
      <input id="bpm2" type="number" min="1" />
      <label for="timeSig2">Time Sig:</label>
      <select id="timeSig2">
        <option value="2/2">2/2</option>
        <option value="3/4">3/4</option>
        <option value="4/4" selected>4/4</option>
        <option value="6/8">6/8</option>
        <option value="9/8">9/8</option>
        <option value="12/8">12/8</option>
      </select>
      <div id="beatIndicator2" class="beat-indicator"></div>
    </div>

    <!-- Row 3 -->
    <div class="song-row" data-row="3">
      <label for="song3">Song 3:</label>
      <input id="song3" type="text" placeholder="Song Name" />
      <label for="bpm3">BPM:</label>
      <input id="bpm3" type="number" min="1" />
      <label for="timeSig3">Time Sig:</label>
      <select id="timeSig3">
        <option value="2/2">2/2</option>
        <option value="3/4">3/4</option>
        <option value="4/4" selected>4/4</option>
        <option value="6/8">6/8</option>
        <option value="9/8">9/8</option>
        <option value="12/8">12/8</option>
      </select>
      <div id="beatIndicator3" class="beat-indicator"></div>
    </div>

    <!-- Row 4 -->
    <div class="song-row" data-row="4">
      <label for="song4">Song 4:</label>
      <input id="song4" type="text" placeholder="Song Name" />
      <label for="bpm4">BPM:</label>
      <input id="bpm4" type="number" min="1" />
      <label for="timeSig4">Time Sig:</label>
      <select id="timeSig4">
        <option value="2/2">2/2</option>
        <option value="3/4">3/4</option>
        <option value="4/4" selected>4/4</option>
        <option value="6/8">6/8</option>
        <option value="9/8">9/8</option>
        <option value="12/8">12/8</option>
      </select>
      <div id="beatIndicator4" class="beat-indicator"></div>
    </div>

    <!-- Row 5 -->
    <div class="song-row" data-row="5">
      <label for="song5">Song 5:</label>
      <input id="song5" type="text" placeholder="Song Name" />
      <label for="bpm5">BPM:</label>
      <input id="bpm5" type="number" min="1" />
      <label for="timeSig5">Time Sig:</label>
      <select id="timeSig5">
        <option value="2/2">2/2</option>
        <option value="3/4">3/4</option>
        <option value="4/4" selected>4/4</option>
        <option value="6/8">6/8</option>
        <option value="9/8">9/8</option>
        <option value="12/8">12/8</option>
      </select>
      <div id="beatIndicator5" class="beat-indicator"></div>
    </div>

    <!-- Row 6 -->
    <div class="song-row" data-row="6">
      <label for="song6">Song 6:</label>
      <input id="song6" type="text" placeholder="Song Name" />
      <label for="bpm6">BPM:</label>
      <input id="bpm6" type="number" min="1" />
      <label for="timeSig6">Time Sig:</label>
      <select id="timeSig6">
        <option value="2/2">2/2</option>
        <option value="3/4">3/4</option>
        <option value="4/4" selected>4/4</option>
        <option value="6/8">6/8</option>
        <option value="9/8">9/8</option>
        <option value="12/8">12/8</option>
      </select>
      <div id="beatIndicator6" class="beat-indicator"></div>
    </div>
  </div>

  <!-- Button to copy URL with current input values -->
  <button id="copyUrlBtn">Copy URL with Values</button>

  <script>
    // Object to store interval IDs and beat counts for each row
    const blinkData = {
      1: { intervalId: null, beatCount: 0 },
      2: { intervalId: null, beatCount: 0 },
      3: { intervalId: null, beatCount: 0 },
      4: { intervalId: null, beatCount: 0 },
      5: { intervalId: null, beatCount: 0 },
      6: { intervalId: null, beatCount: 0 },
    };

    /**
     * Sets up the beat numbers for a row and starts the interval that highlights each beat.
     * @param {number} row - Row number (1 to 6).
     * @param {number} bpm - Beats per minute.
     * @param {string} timeSig - Time signature (e.g., "3/4").
     */
    function setBlinking(row, bpm, timeSig) {
      // Clear any existing interval for this row
      if (blinkData[row].intervalId) {
        clearInterval(blinkData[row].intervalId);
      }
      blinkData[row].beatCount = 0;
      
      const beatIndicator = document.getElementById("beatIndicator" + row);
      
      // If BPM is invalid or zero, clear the beat indicator and exit
      if (!bpm || bpm <= 0) {
        beatIndicator.innerHTML = "";
        return;
      }
      
      // Parse the top number from the time signature (e.g., "3/4" gives 3)
      const topNumber = parseInt(timeSig.split("/")[0], 10);
      
      // Generate beat numbers (e.g., 1 2 3 4) as spans
      let beatHTML = "";
      for (let j = 1; j <= topNumber; j++) {
        beatHTML += `<span data-beat="${j}">${j}</span> `;
      }
      beatIndicator.innerHTML = beatHTML;
      
      // Calculate interval (in ms) per beat
      const interval = (60 / bpm) * 1000;
      
      // Start the interval timer to highlight beats
      blinkData[row].intervalId = setInterval(() => {
        blinkData[row].beatCount++;
        // Calculate the current beat number (wraps around after topNumber)
        const currentBeat = ((blinkData[row].beatCount - 1) % topNumber) + 1;
        // Find the corresponding span element for the current beat
        const span = beatIndicator.querySelector(`span[data-beat="${currentBeat}"]`);
        if (span) {
          // Add an active class to change the color to black
          // (Both beat-active and downbeat-active now set color to black)
          if (currentBeat === 1) {
            span.classList.add("downbeat-active");
          } else {
            span.classList.add("beat-active");
          }
          // Remove the highlight after 100ms
          setTimeout(() => {
            span.classList.remove("downbeat-active");
            span.classList.remove("beat-active");
          }, 100);
        }
      }, interval);
    }

    /**
     * Loads the song, BPM, and time signature values from the URL parameters.
     * Example parameters: ?song1=SongOne&bpm1=120&timeSig1=3/4
     */
    function loadFromUrlParams() {
      const params = new URLSearchParams(window.location.search);
      for (let i = 1; i <= 6; i++) {
        const songField = document.getElementById("song" + i);
        const bpmField  = document.getElementById("bpm" + i);
        const tsField   = document.getElementById("timeSig" + i);
        const songVal = params.get("song" + i);
        const bpmVal  = params.get("bpm" + i);
        const tsVal   = params.get("timeSig" + i);
        if (songVal !== null) songField.value = decodeURIComponent(songVal);
        if (bpmVal !== null)  bpmField.value = bpmVal;
        if (tsVal !== null)   tsField.value = tsVal;
        
        // Start the beat indicator for this row
        const numericBpm = Number(bpmField.value);
        const currentTs  = tsField.value;
        setBlinking(i, numericBpm, currentTs);
      }
    }

    /**
     * Builds a new URL containing the current song, BPM, and time signature values.
     */
    function buildUrlWithValues() {
      const params = new URLSearchParams();
      for (let i = 1; i <= 6; i++) {
        const songVal = document.getElementById("song" + i).value;
        const bpmVal  = document.getElementById("bpm" + i).value;
        const tsVal   = document.getElementById("timeSig" + i).value;
        if (songVal) params.set("song" + i, songVal);
        if (bpmVal)  params.set("bpm" + i, bpmVal);
        if (tsVal)   params.set("timeSig" + i, tsVal);
      }
      return window.location.origin + window.location.pathname + "?" + params.toString();
    }

    /**
     * Copies the provided URL to the clipboard.
     */
    function copyUrlToClipboard(url) {
      navigator.clipboard.writeText(url)
        .then(() => {
          alert("URL copied to clipboard:\n" + url);
        })
        .catch((err) => {
          alert("Failed to copy URL: " + err);
        });
    }

    document.addEventListener("DOMContentLoaded", () => {
      // Load values from URL if present
      loadFromUrlParams();

      // Attach event listeners for BPM and time signature changes on each row
      for (let i = 1; i <= 6; i++) {
        const bpmField = document.getElementById("bpm" + i);
        const tsField  = document.getElementById("timeSig" + i);
        bpmField.addEventListener("input", () => {
          const numericBpm = Number(bpmField.value);
          const currentTs  = tsField.value;
          setBlinking(i, numericBpm, currentTs);
        });
        tsField.addEventListener("change", () => {
          const numericBpm = Number(bpmField.value);
          const currentTs  = tsField.value;
          setBlinking(i, numericBpm, currentTs);
        });
      }

      // Set up Copy URL button
      const copyUrlBtn = document.getElementById("copyUrlBtn");
      copyUrlBtn.addEventListener("click", () => {
        const newUrl = buildUrlWithValues();
        copyUrlToClipboard(newUrl);
      });
    });
  </script>
</body>
</html>
